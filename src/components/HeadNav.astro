---
import { readFileSync } from "node:fs";
import SkipNav from "./SkipNav.astro";
import ThemeButton from "./react/ThemeButton";
import NavbarPopover from "./react/NavbarPopover";

const logoSvg = readFileSync("src/assets/logo.svg", "utf-8");

interface NavLinkItem {
  href: string;
  label: string;
  external?: boolean;
}

const navLinks: NavLinkItem[] = [
  { href: "/about", label: "About" },
  {
    href: "https://github.com/agneym?tab=repositories",
    label: "Projects",
    external: true,
  },
  { href: "/blog", label: "Blog" },
  {
    href: "https://buttondown.email/agney",
    label: "Newsletter",
    external: true,
  },
];

const currentPath = Astro.url.pathname;

function isActive(href: string): boolean {
  if (href.startsWith("http")) return false;
  return currentPath.startsWith(href);
}
---

<SkipNav
  class="text-gray-50 focus:data-reach-skip-link:bg-slate-600 dark:text-gray-700 dark:focus:data-reach-skip-link:bg-slate-200"
/>
<nav
  class="sticky top-0 flex items-center justify-center gap-x-4 bg-inherit px-4 pt-4 pb-2 text-gray-800 opacity-90 backdrop-blur-xs md:justify-between md:px-8 dark:text-gray-400"
>
  <a href="/" class="mr-auto -rotate-6 transition-transform hover:rotate-0">
    <span class="text-slate-900 dark:text-slate-100 [&>svg]:h-10 [&>svg]:w-10">
      <Fragment set:html={logoSvg} />
    </span>
  </a>
  <div class="inline-flex items-center gap-x-8">
    <div class="hidden items-center gap-x-8 md:inline-flex">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            target={link.external ? "_blank" : undefined}
            rel={link.external ? "noopener noreferrer" : undefined}
            class:list={[
              "relative before:absolute before:-bottom-0.5 before:left-0 before:block before:h-0.5 before:w-full before:scale-0 before:bg-current before:transition-transform before:duration-300 before:ease-in-out hover:before:scale-100",
              isActive(link.href) &&
                "text-gray-900 before:scale-100 dark:text-gray-300",
            ]}
          >
            {link.label}
          </a>
        ))
      }
    </div>
    <ThemeButton client:load />
    <NavbarPopover client:load navLinks={navLinks} currentPath={currentPath} />
  </div>
</nav>
